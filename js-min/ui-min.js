function unix_time(){return Math.floor((new Date).getTime()/1e3)}function key_data(a){var b=[a.email,a.passphrase,a.host,a.generation,a.secbits],c=b.join(";");a.key=c}function $(a){return document.getElementById(a)}function toggle_computing(){$("result-need-input").style.visibility="hidden",$("result-computing").style.visibility="visible",$("result-computed").style.visibility="hidden",$("select").style.visibility="hidden"}function toggle_computed(){$("result-need-input").style.visibility="hidden",$("result-computed").style.visibility="visible",$("select").style.visibility="visible",$("result-computing").style.visibility="hidden"}function fnDeSelect(){document.selection?document.selection.empty():window.getSelection&&window.getSelection().removeAllRanges()}function fnSelect(a){fnDeSelect();var b;browser.mobsafari?(a.focus(),a.setSelectionRange(0,16)):document.selection?(b=document.body.createTextRange(),b.moveToElementText(a),b.select()):window.getSelection&&(b=document.createRange(),b.selectNode(a),window.getSelection().addRange(b))}function get_url_params(){var a={},b,c=/\+/g,d=/([^&=]+)=?([^&]*)/g,e=function(a){return decodeURIComponent(a.replace(c," "))},f=window.location.hash.substring(1);while(b=d.exec(f))a[e(b[1])]=e(b[2]);return a}function select_pw(a){var b=$("generated_pw").firstChild;fnSelect(b)}function format_pw(a){var b=a.slice(0,display_prefs.length);return b=add_syms(b,display_prefs.nsym),b}function finish_compute(a){a.computing=!1,context.key=null,toggle_computed();var b=$("generated_pw").firstChild;b.nodeValue=format_pw(a.generated_pw)}function display_computing(a){var b=$("computing").firstChild;b.nodeValue="computing.... "+a}function do_compute_loop(a,b){var c=b,d=10;a==context.key&&(pwgen(b,d,context)?finish_compute(b):(display_computing(b.iter),setTimeout(function(){do_compute_loop(a,c)},0)))}function do_compute(a){toggle_computing();var b=a.key,c=cache[b];c||(cache[b]=a,c=a),c.generated_pw?finish_compute(c):c.computing||(context.key=b,c.computing=!0,c.iter=0,display_computing(""),setTimeout(function(){do_compute_loop(b,c)},500))}function trim(a){var b=/^(\s*)(.*?)(\s*)$/,c=a.match(b);return c[2]}function clean_host(a){return trim(a).toLowerCase()}function clean_email(a){return trim(a).toLowerCase()}function clean_passphrase(a){var b=trim(a);return b.replace(/\s+/g," ")}function pp_set_timer(){var a=unix_time();if(!pp_timer.set||a-pp_timer.set_at>pp_timer.wiggle_room)pp_timer.set=!0,pp_timer.set_at=a,setTimeout(pp_timer_event,pp_timer.timeout*1e3)}function pp_timer_event(){var a=unix_time();pp_timer.set&&a-pp_timer.set_at>=pp_timer.timeout&&($("passphrase").value="",cache={},pp_timer.set=!1,pp_timer.set_at=0)}function pp_input(a){pp_set_timer(),swizzle(a)}function swizzle(a){var b=a.srcElement;b.value.length>0&&(inputs[b.id]=1);var c,d,e;inputs.passphrase&&inputs.host&&inputs.email&&(c=clean_email($("email").value),d=clean_passphrase($("passphrase").value),e=clean_host($("host").value));if(d&&d.length&&e&&e.length&&c&&c.length){var f={email:c,host:e,passphrase:d},g=["generation","secbits"],h,i,j;for(h=0;h<g.length;h++)i=g[h],j=$(i).value,f[i]=j;display_prefs.length=$("length").value,display_prefs.nsym=$("nsym").value,key_data(f),do_compute(f)}return 0}function ungray(a){a.className+=" input-black"}function acceptFocus(a){var b=a.srcElement;b.className.match("input-black")||(ungray(b),b.value="")}function prepopulate(){var a=get_url_params();if(typeof a.email!="undefined"&&a.email.length>0){var b=$("email");ungray(b),b.value=a.email,inputs.email=1}}function domobiles(){var a=/iphone|ipad|ipod/i.test(navigator.userAgent.toLowerCase()),b=/android|blackberry/i.test(navigator.userAgent.toLowerCase());a&&(browser.mobsafari=!0,$("email").type="email")}function doExpand(a){$("expander").style.display="none",$("advanced").style.display="inline"}function doCollapse(a){$("expander").style.display="inline",$("advanced").style.display="none"}var inputs={},cache={},browser={},context={running:0,key:null},pp_timer={set:!1,set_at:0,wiggle_room:30,timeout:300},display_prefs={};