function unix_time(){return Math.floor((new Date).getTime()/1e3)}function key_data(e){var t=[e.email,e.passphrase,e.host,e.generation,e.secbits],n=t.join(";");e.key=n}function $(e){return document.getElementById(e)}function toggle_computing(){$("result-need-input").style.visibility="hidden",$("result-computing").style.visibility="visible",$("result-computed").style.visibility="hidden"}function selectText(e){e.srcElement.focus(),e.srcElement.select()}function toggle_computed(){$("result-need-input").style.visibility="hidden",$("result-computed").style.visibility="visible",$("result-computing").style.visibility="hidden"}function get_url_params(){var e={},t,n=/\+/g,r=/([^&=]+)=?([^&]*)/g,i=function(e){return decodeURIComponent(e.replace(n," "))},s=window.location.hash.substring(1);while(t=r.exec(s))e[i(t[1])]=i(t[2]);return e}function format_pw(e){var t=e.slice(0,display_prefs.length);return t=add_syms(t,display_prefs.nsym),t}function finish_compute(e){e.computing=!1,context.key=null,toggle_computed(),$("generated_pw").value=format_pw(e.generated_pw)}function display_computing(e){var t=$("computing").firstChild;t.nodeValue="computing.... "+e}function do_compute_loop(e,t){var n=t,r=10;e==context.key&&(pwgen(t,r,context)?finish_compute(t):(display_computing(t.iter),setTimeout(function(){do_compute_loop(e,n)},0)))}function do_compute(e){toggle_computing();var t=e.key,n=cache[t];n||(cache[t]=e,n=e),n.generated_pw?finish_compute(n):n.computing||(context.key=t,n.computing=!0,n.iter=0,display_computing(""),setTimeout(function(){do_compute_loop(t,n)},500))}function trim(e){var t=/^(\s*)(.*?)(\s*)$/,n=e.match(t);return n[2]}function clean_host(e){return trim(e).toLowerCase()}function clean_email(e){return trim(e).toLowerCase()}function clean_passphrase(e){var t=trim(e);return t.replace(/\s+/g," ")}function pp_set_timer(){var e=unix_time();if(!pp_timer.set||e-pp_timer.set_at>pp_timer.wiggle_room)pp_timer.set=!0,pp_timer.set_at=e,setTimeout(pp_timer_event,pp_timer.timeout*1e3)}function pp_timer_event(){var e=unix_time();pp_timer.set&&e-pp_timer.set_at>=pp_timer.timeout&&($("passphrase").value="",cache={},pp_timer.set=!1,pp_timer.set_at=0)}function pp_input(e){pp_set_timer(),swizzle(e)}function swizzle(e){var t=e.srcElement;t.value.length>0&&(inputs[t.id]=1);var n,r,i;inputs.passphrase&&inputs.host&&inputs.email&&(n=clean_email($("email").value),r=clean_passphrase($("passphrase").value),i=clean_host($("host").value));if(r&&r.length&&i&&i.length&&n&&n.length){var s={email:n,host:i,passphrase:r},o=["generation","secbits"],u,a,f;for(u=0;u<o.length;u++)a=o[u],f=$(a).value,s[a]=f;display_prefs.length=$("length").value,display_prefs.nsym=$("nsym").value,key_data(s),do_compute(s)}return 0}function ungray(e){e.className+=" input-black"}function acceptFocus(e){var t=e.srcElement;t.className.match("input-black")||(ungray(t),t.value="")}function prepopulate(){var e=get_url_params();if(typeof e.email!="undefined"&&e.email.length>0){var t=$("email");ungray(t),t.value=e.email,inputs.email=1}}function domobiles(){var e=/iphone|ipad|ipod/i.test(navigator.userAgent.toLowerCase()),t=/android|blackberry/i.test(navigator.userAgent.toLowerCase());e&&(browser.mobsafari=!0,$("email").type="email")}function doExpand(e){$("expander").style.display="none",$("advanced").style.display="inline"}function doCollapse(e){$("expander").style.display="inline",$("advanced").style.display="none"}var inputs={},cache={},browser={},context={running:0,key:null},pp_timer={set:!1,set_at:0,wiggle_room:30,timeout:300},display_prefs={};